<!DOCTYPE html>
<html lang="pt-br">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Free'La</title>
  <link rel="shortcut icon" href="../static/imgs/icon.png">
  <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/css/bootstrap.min.css"
    integrity="sha384-MCw98/SFnGE8fJT3GXwEOngsV7Zt27NXFoaoApmYm81iuXoPkFOJwJ8ERdknLPMO" crossorigin="anonymous">
  <link rel="stylesheet" href="{{ url_for('static', filename='css/sidebar.css') }}">
  <link rel="stylesheet" href="{{ url_for('static', filename='css/complementos.css') }}">

</head>

<body>
  <header>
    <div class="container">
      <!-- Para celulares -->
      <nav class="menu_lateral" id="menu_lateral">
        <div class="expandir">
          <i class="bi bi-list"></i>
        </div>
        <ul>
          <img src="/profile/imagem/{{ session.user_id }}" class="img_sidebar" alt="Perfil" width="140px" style="margin-left: 1rem;">
          <li class="item_menu">
            <a href="/perfil">
              <span class="icon"></span>
              <span class="link">Perfil</span>
            </a>
          </li>
          <li class="item_menu">
            <a href="/perfilPublico/1">
              <span class="icon"><i class="#"></i></span>
              <span class="link">Sobre</span>
            </a>
          </li>
          <li class="item_menu">
            <a href="#">
              <span class="icon"><i class="#"></i></span>
              <span class="link">Contato</span>
            </a>
          </li>
          <li class="item_menu has-submenu">
            <a href="#" onclick="toggleSubmenu(event)">
              <span class="icon"><i class="#"></i></span>
              <span class="link">Configurações</span>
            </a>

            <ul class="submenu">
              <li class="item_menu" id="submenu">
                <a href="/alterarDados">
                  <span class="icon"><i class="#"></i></span>
                  <span class="link">Atualizar Dados</span>
                </a>
              </li>
              <li class="item_menu" id="submenu">
                <a href="#" onclick="showPopUpDeletar()">
                  <span class="icon"><i class="#"></i></span>
                  <span class="link">Deletar Perfil</span>
                </a>
              </li>
              <li class="item_menu" id="submenu">
                {% if session.user_id %}
                <a href="/" onclick="logout()">
                  <span class="icon"><i class="bi bi-box-arrow-right"></i></span>
                  <span class="link">Logout</span>
                </a>
                {% else %}
                <a href="/">
                  <span class="icon"><i class="bi bi-box-arrow-in-right"></i></span>
                  <span class="link">Login</span>
                </a>
                {% endif %}
              </li>
            </ul>
          </li>
        </ul>
      </nav>
    </div>

    <div class="overlay" id="overlay"></div>
    <div class="pop-up-deletar" id="pop-up-deletar">
      <h3>Deletar Perfil?</h3>
      <p>Tem certeza que deseja excluir seu perfil? <br>
        Você perderá todos seus dados e não poderá executar todas as funcionalidades do Site</p>
      <button onclick="fecharPopUpDeletar()">NÃO, RETORNAR PARA A HOMEPAGE</button>
      <button onclick="confirmarDelecao()">SIM, DESEJO DELETAR OS MEUS DADOS</button>
    </div>


    <!-- Par desktops -->
    <nav class="desktop-version">
      <div class="navbar navbar-dark bg-dark shadow-sm">
        <div class="container d-flex justify-content-between">
          {% if session.user_id %}
          <a href="/perfil" class="navbar-brand d-flex align-items-center">
            Olá, {{ obter_nome_usuario() }}
          </a>
          {% else %}
          <a href="/" class="navbar-brand d-flex align-items-center">
            Login
          </a>
          {% endif %}
          <a href="/perfilPublico/1" class="phone-hidden">Sobre</a>
          <a href="#" class="phone-hidden">Contato</a>
          <a href="#" class="phone-hidden dropdown-toggle" id="desktopConfigDropdown" data-toggle="dropdown"
            aria-haspopup="true" aria-expanded="false">Configurações</a>
          <div class="dropdown-menu" aria-labelledby="desktopConfigDropdown">
            <a class="dropdown-item" href="/alterarDados">Atualizar Dados</a>
            <a class="dropdown-item" href="#" onclick="showPopUpDeletar()">Deletar Perfil</a>
            {% if session.user_id %}
            <a class="dropdown-item" href="/" onclick="logout()">Logout</a>
            {% else %}
            <a class="dropdown-item" href="/">Login</a>
            {% endif %}
          </div>
          <button id="toggleSidebar" style="font-size: 20px;">☰</button> <!-- Some na versão desktop -->
        </div>
      </div>
    </nav>
  </header>

  <main>

    <!-- Centro do site -->
    <section class="jumbotron text-center">
      <div class="container">
        <img class="logo" src="/static/imgs/free'la.png" width="110%" height="100%">
        <br><br>
        <p class="lead text-muted">O Free'la é a plataforma ideal para conectar talentos a oportunidades! Seja você um
          freelancer em busca de novos projetos, uma empresa precisando de especialistas ou apenas alguém precisando de
          ajuda, aqui você encontra profissionais qualificados e serviços sob medida para suas necessidades. Com um
          sistema intuitivo e seguro, o Free'la facilita negociações e entrega de trabalhos, garantindo agilidade e
          qualidade para todos. Encontre, contrate e colabore com os melhores do mercado em um só lugar!</p>
        <div class="d-flex justify-content-center">
          <input class="pesquisa" type="text" placeholder="Pesquise por nome ou descrição..." id="campo-pesquisa">
          <select id="categoriaDropdown categoriaServico" class="form-control mx-2" style="width: 200px;">
            <option value="">Todas as categorias</option>
            <!-- As opções serão preenchidas dinamicamente -->
          </select>
          <button class="pesquisar_btn" onclick="pesquisar()">
            <img src="/static/imgs/pesquisa-de-lupa.png" width="20px">
          </button>
        </div>
      </div>
    </section>

    <!-- Seção de Perfis Ativos -->
    <section>
      <h2>Perfis Ativos</h2>
      <div class="perfil-lista">
        {% for perfil in perfis %}
        <div class="perfil-card">
          <img src="/profile/imagem/{{ perfil.ID_User }}" alt="Foto de Perfil" width="100" height="100">
          <h3>{{ perfil.Nome }}</h3>
          <p><strong>Categoria:</strong> {{ perfil.NomeCategoria or 'Não informado' }}</p>
          <p><strong>Bio:</strong> {{ perfil.Bio or 'Sem descrição' }}</p>
          <a href="/perfilPublico/{{ perfil.ID_User }}">Ver Perfil</a>
        </div>
        {% endfor %}
      </div>
    </section>

    <!-- Seção de Resultados da Pesquisa -->
    <section>
      <h2>Resultados da Pesquisa</h2>
      <div id="freelancersContainer" class="container mt-4">
        <!-- Freelancers serão carregados dinamicamente aqui -->
      </div>
    </section>

    <!-- Seção de Resultados -->

    <div class="album py-5 bg-light">
      <div class="container">
        <div class="row" id="perfis-container">
          <!-- Os cards serão gerados aqui via JavaScript -->
        </div>
      </div>
    </div>


  </main>
</body>
<script>
  function toggleSubmenu(event) {
    event.preventDefault();
    const item = event.currentTarget.closest('.has-submenu');
    item.classList.toggle('active');
  }
</script>
<script>
  async function carregarCategorias() {
    try {
      const response = await fetch('/category');
      if (!response.ok) throw new Error('Erro ao carregar categorias');
      const data = await response.json();

      if (data.sucesso && Array.isArray(data.categorias)) {
        const dropdown = document.getElementById('categoriaDropdown');
        dropdown.innerHTML = '<option value="">Todas as categorias</option>'; // Reset dropdown
        data.categorias.forEach(categoria => {
          const option = document.createElement('option');
          option.value = categoria.NomeCategoria;
          option.textContent = categoria.NomeCategoria;
          dropdown.appendChild(option);
        });
      } else {
        console.error('Categorias inválidas ou não encontradas.');
      }
    } catch (error) {
      console.error('Erro ao carregar categorias:', error);
    }
  }

  async function pesquisar() {
    const termo = document.getElementById('campo-pesquisa').value.trim();
    const categoria = document.getElementById('categoriaDropdown').value;

    try {
      const response = await fetch(`/buscarFreelancers?termo=${encodeURIComponent(termo)}&categoria=${encodeURIComponent(categoria)}`);
      if (!response.ok) throw new Error('Erro ao buscar freelancers');
      const data = await response.json();

      const container = document.getElementById('freelancersContainer');
      container.innerHTML = '';

      if (data.sucesso && Array.isArray(data.freelancers) && data.freelancers.length > 0) {
        data.freelancers.forEach(freelancer => {
          container.innerHTML += `
            <div class="card mb-3">
              <div class="card-body">
                <img src="/profile/imagem/${freelancer.ID_User}" alt="Foto de Perfil" width="100" height="100">
                <h5 class="card-title">${freelancer.Nome}</h5>
                <p class="card-text">${freelancer.Bio || 'Sem descrição disponível.'}</p>
                <a href="/perfilPublico/${freelancer.ID_User}" class="btn btn-primary">Ver Perfil</a>
              </div>
            </div>`;
        });
      } else {
        container.innerHTML = '<p>Nenhum freelancer encontrado.</p>';
      }
    } catch (error) {
      console.error('Erro ao buscar freelancers:', error);
    }
  }

  document.addEventListener('DOMContentLoaded', carregarCategorias);
</script>
<script src="{{ url_for('static', filename='js/homepage.js') }}"></script>
<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11" defer></script>
<script src="https://code.jquery.com/jquery-3.3.1.slim.min.js"
  integrity="sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.3/umd/popper.min.js"
  integrity="sha384-ZMP7rVo3mIykV+2+9J3UJ46jBk0WLaUAdn689aCwoqbBJiSnjAK/l8WvCWPIPm49" crossorigin="anonymous"></script>
<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/js/bootstrap.min.js"
  integrity="sha384-ChfqqxuZUCnJSK3+MXmPNIyE6ZbWh2IMqE241rYiqJxyMiZ6OW/JmZQ5stwEULTy" crossorigin="anonymous"></script>

</html>